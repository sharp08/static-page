import{m as P,y as b,B as G,R as N,r as h,z as _,c as $,A as R,P as I,j as l,_ as E}from"./index-BEVwWGVc.js";import{_ as j,u as T,S as v,r as U,a as M}from"./sortable.esm-BWerqriO.js";import{C as D,b as O,c as L,M as z,D as H,d as F}from"./core.esm-BXNEaAg-.js";import{r as k}from"./modifiers.esm-CawMKbcG.js";import{I as A}from"./image-Bdy5_cYd.js";import"./IconClose-DuoACxKe.js";var V=b();const X=P(V),q={PREFIX:`${G}-space`},x={ALIGN_SET:["start","end","center","baseline"],SPACING_LOOSE:"loose",SPACING_MEDIUM:"medium",SPACING_TIGHT:"tight"},B="Symbol(react.fragment)",C=m=>{let t=[];return N.Children.forEach(m,e=>{e!=null&&(Array.isArray(e)?t=t.concat(C(e)):h.isValidElement(e)&&e.type&&e.type.toString()===B&&e.props?t=t.concat(C(e.props.children)):t.push(e))}),t},f=q.PREFIX;class w extends h.PureComponent{render(){const{children:t=null,style:e,className:p,spacing:s,wrap:o,align:c,vertical:n}=this.props,g=o&&n?!1:o,a=Object.assign({},e);let r="",i="";_(s)?(r=s,i=s):j(s)?(a.rowGap=s,a.columnGap=s):X(s)&&(_(s[0])?r=s[0]:j(s[0])&&(a.columnGap=`${s[0]}px`),_(s[1])?i=s[1]:j(s[1])&&(a.rowGap=`${s[1]}px`));const u=$(f,p,{[`${f}-align-${c}`]:c,[`${f}-vertical`]:n,[`${f}-horizontal`]:!n,[`${f}-wrap`]:g,[`${f}-tight-horizontal`]:r===x.SPACING_TIGHT,[`${f}-tight-vertical`]:i===x.SPACING_TIGHT,[`${f}-medium-horizontal`]:r===x.SPACING_MEDIUM,[`${f}-medium-vertical`]:i===x.SPACING_MEDIUM,[`${f}-loose-horizontal`]:r===x.SPACING_LOOSE,[`${f}-loose-vertical`]:i===x.SPACING_LOOSE}),d=C(t),S=R(this.props);return N.createElement("div",Object.assign({},S,{className:u,style:a,"x-semi-prop":"children"}),d)}}w.propTypes={wrap:I.bool,align:I.oneOf(x.ALIGN_SET),vertical:I.bool,spacing:I.oneOfType([I.string,I.number,I.array]),children:I.node,style:I.object,className:I.string};w.defaultProps={vertical:!1,wrap:!1,spacing:"tight",align:"center"};const W="_wrapper_1ty3g_1",Y="_del_1ty3g_14",J="_semiImage_1ty3g_20",y={wrapper:W,del:Y,semiImage:J};function K({setList:m,data:t}){const{listeners:e,setNodeRef:p,transform:s,transition:o}=T({id:t.id,transition:{duration:200,easing:"cubic-bezier(0.25, 1, 0.5, 1)"}}),c={transition:o,transform:D.Transform.toString(s)};function n(){m(g=>{let a=[...g];return a=a.filter(r=>r.id!==t.id),a})}return l.jsxs("li",{className:y.wrapper,style:c,ref:p,children:[l.jsx("button",{className:y.del,onClick:n,children:"删除"}),l.jsx(A,{...e,className:y.semiImage,src:t.url,preview:{url:t.url}})]})}const Q="_container_exzya_1",Z={container:Q};function ee(m,t){const[e,p]=h.useState([{id:"a1",url:"01.jpg"},{id:"a2",url:"02.jpg"},{id:"a3",url:"03.jpg"}]),s=O(L(z,{activationConstraint:{distance:5}}));function o(r){return e.findIndex(u=>u.id===r)}function c({active:r,over:i}){if(E.isEmpty(i))return;const u=o(r.id),d=o(i.id);u!==d&&p(S=>M(S,u,d))}const n=h.useRef();function g(){n.current.click()}function a(r){const i=r.target.files;E.isEmpty(i)||p(u=>{const d=[...u];return Array.from(i).forEach(S=>{d.push({id:E.uniqueId("upload:"),url:URL.createObjectURL(S)})}),r.target.value="",d})}return h.useImperativeHandle(t,()=>({list:e})),l.jsx(H,{sensors:s,collisionDetection:F,onDragEnd:c,modifiers:[k],children:l.jsx(v,{items:e.map(r=>r.id),strategy:U,children:l.jsxs("ul",{className:Z.container,children:[e.map(r=>l.jsx(K,{setList:p,data:r},r.id)),l.jsx("li",{className:y.wrapper,onClick:g,children:"上传"}),l.jsx("input",{ref:n,hidden:!0,type:"file",multiple:!0,onChange:a})]})})})}const te=h.forwardRef(ee),se="_semiImage_1hc02_1",re={semiImage:se};function ne(m){const t=[];function e(){let o=0;const c=Math.max(...t.map(i=>i.width));t.forEach(i=>{const u=c/i.width,d=i.height*u;o+=d});const n=document.createElement("canvas");n.width=c,n.height=o;const g=n.getContext("2d");let a=0;return t.forEach(i=>{const u=c/i.width,d=i.height*u;g.drawImage(i,0,a,c,d),a+=d}),n.toDataURL("image/png")}const p=m.map((o,c)=>new Promise((n,g)=>{const a=new Image;a.crossOrigin="anonymous",a.index=c,a.src=o,a.onload=function(){t.push(a),n()},a.onerror=function(r){g(r)}}));return Promise.allSettled(p).then(o=>{if(o.some(n=>n.status==="rejected"))throw new Error(`加载图片失败: ${m[o.findIndex(n=>n.status==="rejected")]}`);return t.sort((n,g)=>n.index-g.index),e()})}function ae(m){return l.jsx(A,{className:re.semiImage,src:m.url,preview:{url:m.url}})}const ie="_container_11i26_1",oe={container:ie};function ge(){const[m,t]=h.useState(),e=h.useRef();function p(){const s=e.current.list.map(o=>o.url);ne(s).then(o=>{t(o)})}return l.jsxs(w,{className:oe.container,children:[l.jsx(te,{ref:e}),l.jsx("button",{onClick:p,style:{flexShrink:0},children:"拼接"}),l.jsx(ae,{url:m})]})}export{ge as default};
