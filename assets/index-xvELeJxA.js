import{a as _,B as N,b as k,R as c,c as I,i as A,I as M,C as W,P as d,g as L,d as T,r as x,e as S,f as R,h as z}from"./index-BEVwWGVc.js";import{_ as F}from"./sortable.esm-BWerqriO.js";import{I as B}from"./IconClose-DuoACxKe.js";import{I as X,a as D,b as H}from"./IconTickCircle-Drcd04tM.js";import{I as q}from"./IconAlertTriangle-D_dmra6z.js";class $ extends _{constructor(n){super(Object.assign(Object.assign({},$.defaultAdapter),n)),this.handleMouseInSideChange=e=>{this._adapter.handleMouseInSideChange(e)},this.getInputWrapperRect=()=>this._adapter.getInputWrapperRect()}hasToast(n){return this._adapter.getState("list").map(t=>{let{id:a}=t;return a}).includes(n)}addToast(n){const e=this._adapter.getState("list");e.push(n),this._adapter.updateToast(e,[],[])}updateToast(n,e){let t=this._adapter.getState("list");t=t.map(s=>s.id===n?Object.assign(Object.assign({},s),e):s);const a=t.filter(s=>s.id===n);this._adapter.updateToast(t,[],a)}removeToast(n){let e=this._adapter.getState("list");const t=[];e=e.filter(a=>a.id===n?(t.push(a),!1):!0),this._adapter.updateToast(e,t,[])}destroyAll(){const n=this._adapter.getState("list");n.length>0&&this._adapter.updateToast([],n,[])}}const P=`${N}-toast`,b={PREFIX:P,WRAPPER:`${P}-wrapper`},y={types:["warning","success","info","error","default"],themes:["normal","light"],directions:["ltr","rtl"]},U={duration:3};class w extends _{constructor(n){super(Object.assign(Object.assign({},w.defaultAdapter),n)),this._timer=null,this._id=null}init(){this.startCloseTimer_(),this._id=this._adapter.getProp("id")}destroy(){this.clearCloseTimer_()}startCloseTimer_(){const n=this._adapter.getProp("duration");n&&F(n)&&(this._timer=setTimeout(()=>{this.close()},n*1e3))}close(n){n&&n.stopPropagation(),this._adapter.notifyWrapperToRemove(this._id),this._adapter.notifyClose()}clearCloseTimer_(){this._timer&&(clearTimeout(this._timer),this._timer=null)}restartCloseTimer(){this.clearCloseTimer_(),this.startCloseTimer_()}}const f=b.PREFIX;let g=class extends k{constructor(n){super(n),this.toastEle=c.createRef(),this.clearCloseTimer=()=>{this.foundation.clearCloseTimer_()},this.startCloseTimer=()=>{this.foundation.startCloseTimer_()},this.restartCloseTimer=()=>{this.foundation.restartCloseTimer()},this.state={},this.foundation=new w(this.adapter)}get adapter(){return Object.assign(Object.assign({},super.adapter),{notifyWrapperToRemove:n=>{this.props.close(n)},notifyClose:()=>{this.props.onClose()}})}componentDidMount(){this.foundation.init()}componentWillUnmount(){this.foundation.destroy()}close(n){this.foundation.close(n)}renderIcon(){const{type:n,icon:e}=this.props,a={warning:c.createElement(q,null),success:c.createElement(H,null),info:c.createElement(D,null),error:c.createElement(X,null)}[n],s="large",i=I(`${f}-icon`,`${f}-icon-${n}`);return e?A(e)?c.cloneElement(e,{size:s,className:`${f}-icon`}):e:n&&a?c.cloneElement(a,{size:s,className:i}):null}render(){const{content:n,type:e,theme:t,showClose:a,textMaxWidth:s,className:i,style:r}=this.props,u=this.props.direction||this.context.direction,m=I(f,i,{[`${f}-${e}`]:!0,[`${f}-${t}`]:t==="light",[`${f}-rtl`]:u==="rtl"}),p={};p.maxWidth=s;const h="borderless",E="small",v=this.props.positionInList?this.props.positionInList.length-this.props.positionInList.index-1:0,C=c.createElement("div",{ref:this.toastEle,role:"alert","aria-label":`${e||"default"} type`,className:m,style:Object.assign(Object.assign({},r),{transform:`translate3d(0,0,${v*-10}px)`}),onMouseEnter:this.clearCloseTimer,onMouseLeave:this.startCloseTimer,onAnimationStart:this.props.onAnimationStart,onAnimationEnd:this.props.onAnimationEnd},c.createElement("div",{className:`${f}-content`},this.renderIcon(),c.createElement("span",{className:`${f}-content-text`,style:p,"x-semi-prop":"content"},n),a&&c.createElement("div",{className:`${f}-close-button`},c.createElement(M,{onClick:j=>this.close(j),type:"tertiary",icon:c.createElement(B,{"x-semi-prop":"icon"}),theme:h,size:E}))));if(this.props.stack){const j=this.props.stackExpanded&&this.toastEle.current&&getComputedStyle(this.toastEle.current).height||0;return c.createElement("div",{className:`${f}-zero-height-wrapper`,style:{height:j}},C)}else return C}};g.contextType=W;g.propTypes={onClose:d.func,content:d.node,close:d.func,duration:d.number,theme:d.oneOf(y.themes),type:d.oneOf(y.types),textMaxWidth:d.oneOfType([d.string,d.number]),style:d.object,className:d.string,showClose:d.bool,stack:d.bool,stackExpanded:d.bool,icon:d.node,direction:d.oneOf(y.directions)};g.__SemiComponentName__="Toast";g.defaultProps=L(g.__SemiComponentName__,{onClose:T,content:"",close:T,duration:U.duration,textMaxWidth:450,showClose:!0,stack:!1,stackExpanded:!1,theme:"normal"});var G=function(l,n){var e={};for(var t in l)Object.prototype.hasOwnProperty.call(l,t)&&n.indexOf(t)<0&&(e[t]=l[t]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(l);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(l,t[a])&&(e[t[a]]=l[t[a]]);return e};const V=(l,n)=>{var{afterClose:e}=l,t=G(l,["afterClose"]);const[a,s]=x.useState(!0),i=()=>{s(!1)};return c.useImperativeHandle(n,()=>({close:()=>{s(!1)}})),x.useEffect(()=>{a||e(t.id)},[a]),a?c.createElement(g,Object.assign({},t,{close:i})):null},J=c.forwardRef(V),O={motion:!0,zIndex:1010,duration:3};function K(){const[l,n]=c.useState([]);function e(t,a){return n(s=>[{element:t,config:a},...s]),s=>{n(i=>i.filter(r=>{let{config:u}=r;return u.id!==s}))}}return[l,e]}function Q(){const[l,n]=K(),e=x.useRef(new Map),t=s=>{const i=S("semi_toast_"),r=Object.assign(Object.assign({},s),{id:i});let u;const m=c.createElement(J,Object.assign({},r,{key:i,afterClose:p=>u(p),ref:p=>{var h;e.current.set(i,{close:(h=p==null?void 0:p.close)!==null&&h!==void 0?h:T})}}));return u=n(m,Object.assign({},r)),i},a=s=>{var i;const{close:r}=(i=e.current.get(s))!==null&&i!==void 0?i:{};r==null||r()};return[{success:s=>t(Object.assign(Object.assign(Object.assign({},O),s),{type:"success"})),info:s=>t(Object.assign(Object.assign(Object.assign({},O),s),{type:"info"})),error:s=>t(Object.assign(Object.assign(Object.assign({},O),s),{type:"error"})),warning:s=>t(Object.assign(Object.assign(Object.assign({},O),s),{type:"warning"})),open:s=>t(Object.assign(Object.assign(Object.assign({},O),s),{type:"default"})),close:s=>a(s)},c.createElement(c.Fragment,null,Array.isArray(l)&&l.length?c.createElement(c.Fragment,null,l.map(s=>s.element)):null)]}const Y=()=>{var l;return l=class o extends k{constructor(e){super(e),this.stack=!1,this.innerWrapperRef=c.createRef(),this.handleMouseEnter=t=>{this.stack&&this.foundation.handleMouseInSideChange(!0)},this.handleMouseLeave=t=>{var a;this.stack&&(!((a=this.foundation.getInputWrapperRect())===null||a===void 0)&&a.height)&&this.foundation.handleMouseInSideChange(!1)},this.state={list:[],removedItems:[],updatedItems:[],mouseInSide:!1},this.foundation=new $(this.adapter)}get adapter(){return Object.assign(Object.assign({},super.adapter),{updateToast:(e,t,a)=>{this.setState({list:e,removedItems:t,updatedItems:a})},handleMouseInSideChange:e=>{this.setState({mouseInSide:e})},getInputWrapperRect:()=>{var e;return(e=this.innerWrapperRef.current)===null||e===void 0?void 0:e.getBoundingClientRect()}})}static create(e){var t;const a=(t=e.id)!==null&&t!==void 0?t:S("toast");if(o.ref){const s=document.querySelector(`#${this.wrapperId}`);["top","left","bottom","right"].map(i=>{i in e&&(s.style[i]=typeof e[i]=="number"?`${e[i]}px`:e[i])}),!!e.stack!==o.ref.stack&&(o.ref.stack=!!e.stack),o.ref.has(a)?o.ref.update(a,Object.assign(Object.assign({},e),{id:a})):o.ref.add(Object.assign(Object.assign({},e),{id:a}))}else{const s=document.createElement("div");this.wrapperId||(this.wrapperId=S("toast-wrapper").slice(0,26)),s.className=b.WRAPPER,s.id=this.wrapperId,s.style.zIndex=String(typeof e.zIndex=="number"?e.zIndex:o.defaultOpts.zIndex),["top","left","bottom","right"].map(i=>{if(i in o.defaultOpts||i in e){const r=e[i]?e[i]:o.defaultOpts[i];s.style[i]=typeof r=="number"?`${r}px`:r}}),o.defaultOpts.getPopupContainer?o.defaultOpts.getPopupContainer().appendChild(s):document.body.appendChild(s),R.render(c.createElement(o,{ref:i=>o.ref=i}),s,()=>{o.ref.add(Object.assign(Object.assign({},e),{id:a})),o.ref.stack=!!e.stack})}return a}static close(e){o.ref&&o.ref.remove(e)}static destroyAll(){if(o.ref){o.ref.destroyAll();const e=document.querySelector(`#${this.wrapperId}`);R.unmountComponentAtNode(e),e&&e.parentNode.removeChild(e),o.ref=null,this.wrapperId=null}}static getWrapperId(){return this.wrapperId}static info(e){return typeof e=="string"&&(e={content:e}),this.create(Object.assign(Object.assign(Object.assign({},o.defaultOpts),e),{type:"info"}))}static warning(e){return typeof e=="string"&&(e={content:e}),this.create(Object.assign(Object.assign(Object.assign({},o.defaultOpts),e),{type:"warning"}))}static error(e){return typeof e=="string"&&(e={content:e}),this.create(Object.assign(Object.assign(Object.assign({},o.defaultOpts),e),{type:"error"}))}static success(e){return typeof e=="string"&&(e={content:e}),this.create(Object.assign(Object.assign(Object.assign({},o.defaultOpts),e),{type:"success"}))}static config(e){["top","left","bottom","right"].forEach(t=>{t in e&&(o.defaultOpts[t]=e[t])}),typeof e.theme=="string"&&y.themes.includes(e.theme)&&(o.defaultOpts.theme=e.theme),typeof e.zIndex=="number"&&(o.defaultOpts.zIndex=e.zIndex),typeof e.duration=="number"&&(o.defaultOpts.duration=e.duration),typeof e.getPopupContainer=="function"&&(o.defaultOpts.getPopupContainer=e.getPopupContainer)}has(e){return this.foundation.hasToast(e)}add(e){return this.foundation.addToast(e)}update(e,t){return this.foundation.updateToast(e,t)}remove(e){return this.foundation.removeToast(e)}destroyAll(){return this.foundation.destroyAll()}render(){let{list:e}=this.state;const{removedItems:t,updatedItems:a}=this.state;e=Array.from(new Set([...e,...t]));const s=a.map(r=>{let{id:u}=r;return u}),i=r=>{var u;!((u=r==null?void 0:r.foundation)===null||u===void 0)&&u._id&&s.includes(r.foundation._id)&&r.foundation.restartCloseTimer()};return c.createElement(c.Fragment,null,c.createElement("div",{className:I({[`${b.PREFIX}-innerWrapper`]:!0,[`${b.PREFIX}-innerWrapper-hover`]:this.state.mouseInSide}),ref:this.innerWrapperRef,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},e.map((r,u)=>{const m=t.find(p=>p.id===r.id)!==void 0;return c.createElement(z,{key:r.id,motion:r.motion,animationState:m?"leave":"enter",startClassName:m?`${b.PREFIX}-animation-hide`:`${b.PREFIX}-animation-show`},p=>{let{animationClassName:h,animationEventsNeedBind:E,isAnimating:v}=p;return m&&!v?null:c.createElement(g,Object.assign({},r,{stack:this.stack,stackExpanded:this.state.mouseInSide,positionInList:{length:e.length,index:u},className:I({[r.className]:!!r.className,[h]:!0})},E,{style:Object.assign({},r.style),close:C=>this.remove(C),ref:i}))})})))}},l.defaultOpts={motion:!0,zIndex:1010,content:""},l.propTypes={content:d.node,duration:d.number,onClose:d.func,icon:d.node,direction:d.oneOf(y.directions),stack:d.bool},l.defaultProps={},l};class Z{static create(n){const e=Y();return e.useToast=Q,n&&e.config(n),e}}const re=Z.create();export{re as T};
