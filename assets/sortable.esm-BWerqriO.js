import{D as de,E as le,m as fe,r as f,R as X}from"./index-BEVwWGVc.js";import{f as ge,g as be,h as B,a as pe,u as me,i as ve,C as H,j as Ie,k as xe,K as E}from"./core.esm-BXNEaAg-.js";var _,K;function ye(){if(K)return _;K=1;var e=de(),r=le(),t="[object Number]";function n(a){return typeof a=="number"||r(a)&&e(a)==t}return _=n,_}var he=ye();const qe=fe(he);function U(e,r,t){const n=e.slice();return n.splice(t<0?n.length+t:t,0,n.splice(r,1)[0]),n}function De(e,r){return e.reduce((t,n,a)=>{const c=r.get(n);return c&&(t[a]=c),t},Array(e.length))}function O(e){return e!==null&&e>=0}function Re(e,r){if(e===r)return!0;if(e.length!==r.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==r[t])return!1;return!0}function Ce(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const V=e=>{let{rects:r,activeIndex:t,overIndex:n,index:a}=e;const c=U(r,n,t),s=r[a],i=c[a];return!i||!s?null:{x:i.left-s.left,y:i.top-s.top,scaleX:i.width/s.width,scaleY:i.height/s.height}},Y="Sortable",$=X.createContext({activeIndex:-1,containerId:Y,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:V,disabled:{draggable:!1,droppable:!1}});function Me(e){let{children:r,id:t,items:n,strategy:a=V,disabled:c=!1}=e;const{active:s,dragOverlay:i,droppableRects:g,over:d,measureDroppableContainers:o}=ge(),p=be(Y,t),v=i.rect!==null,l=f.useMemo(()=>n.map(I=>typeof I=="object"&&"id"in I?I.id:I),[n]),T=s!=null,h=s?l.indexOf(s.id):-1,m=d?l.indexOf(d.id):-1,N=f.useRef(l),D=!Re(l,N.current),R=m!==-1&&h===-1||D,b=Ce(c);B(()=>{D&&T&&o(l)},[D,l,T,o]),f.useEffect(()=>{N.current=l},[l]);const C=f.useMemo(()=>({activeIndex:h,containerId:p,disabled:b,disableTransforms:R,items:l,overIndex:m,useDragOverlay:v,sortedRects:De(l,g),strategy:a}),[h,p,b.draggable,b.droppable,R,l,m,g,v,a]);return X.createElement($.Provider,{value:C},r)}const we=e=>{let{id:r,items:t,activeIndex:n,overIndex:a}=e;return U(t,n,a).indexOf(r)},Se=e=>{let{containerId:r,isSorting:t,wasDragging:n,index:a,items:c,newIndex:s,previousItems:i,previousContainerId:g,transition:d}=e;return!d||!n||i!==c&&a===s?!1:t?!0:s!==a&&r===g},Te={duration:200,easing:"ease"},J="transform",Ne=H.Transition.toString({property:J,duration:0,easing:"linear"}),Ee={roleDescription:"sortable"};function Oe(e){let{disabled:r,index:t,node:n,rect:a}=e;const[c,s]=f.useState(null),i=f.useRef(t);return B(()=>{if(!r&&t!==i.current&&n.current){const g=a.current;if(g){const d=xe(n.current,{ignoreTransform:!0}),o={x:g.left-d.left,y:g.top-d.top,scaleX:g.width/d.width,scaleY:g.height/d.height};(o.x||o.y)&&s(o)}}t!==i.current&&(i.current=t)},[r,t,n,a]),f.useEffect(()=>{c&&s(null)},[c]),c}function ze(e){let{animateLayoutChanges:r=Se,attributes:t,disabled:n,data:a,getNewIndex:c=we,id:s,strategy:i,resizeObserverConfig:g,transition:d=Te}=e;const{items:o,containerId:p,activeIndex:v,disabled:l,disableTransforms:T,sortedRects:h,overIndex:m,useDragOverlay:N,strategy:D}=f.useContext($),R=Ae(n,l),b=o.indexOf(s),C=f.useMemo(()=>({sortable:{containerId:p,index:b,items:o},...a}),[p,a,b,o]),I=f.useMemo(()=>o.slice(o.indexOf(s)),[o,s]),{rect:j,node:q,isOver:Q,setNodeRef:M}=pe({id:s,data:C,disabled:R.droppable,resizeObserverConfig:{updateMeasurementsFor:I,...g}}),{active:w,activatorEvent:W,activeNodeRect:Z,attributes:ee,setNodeRef:z,listeners:te,isDragging:A,over:re,setActivatorNodeRef:ne,transform:se}=me({id:s,data:C,attributes:{...Ee,...t},disabled:R.draggable}),ae=ve(M,z),x=!!w,P=x&&!T&&O(v)&&O(m),k=!N&&A,F=k&&P?se:null,oe=P?F??(i??D)({rects:h,activeNodeRect:Z,activeIndex:v,overIndex:m,index:b}):null,S=O(v)&&O(m)?c({id:s,items:o,activeIndex:v,overIndex:m}):b,y=w==null?void 0:w.id,u=f.useRef({activeId:y,items:o,newIndex:S,containerId:p}),ie=o!==u.current.items,G=r({active:w,containerId:p,isDragging:A,isSorting:x,id:s,index:b,items:o,newIndex:u.current.newIndex,previousItems:u.current.items,previousContainerId:u.current.containerId,transition:d,wasDragging:u.current.activeId!=null}),L=Oe({disabled:!G,index:b,node:q,rect:j});return f.useEffect(()=>{x&&u.current.newIndex!==S&&(u.current.newIndex=S),p!==u.current.containerId&&(u.current.containerId=p),o!==u.current.items&&(u.current.items=o)},[x,S,p,o]),f.useEffect(()=>{if(y===u.current.activeId)return;if(y&&!u.current.activeId){u.current.activeId=y;return}const ce=setTimeout(()=>{u.current.activeId=y},50);return()=>clearTimeout(ce)},[y]),{active:w,activeIndex:v,attributes:ee,data:C,rect:j,index:b,newIndex:S,items:o,isOver:Q,isSorting:x,isDragging:A,listeners:te,node:q,overIndex:m,over:re,setNodeRef:ae,setActivatorNodeRef:ne,setDroppableNodeRef:M,setDraggableNodeRef:z,transform:L??oe,transition:ue()};function ue(){if(L||ie&&u.current.newIndex===b)return Ne;if(!(k&&!Ie(W)||!d)&&(x||G))return H.Transition.toString({...d,property:J})}}function Ae(e,r){var t,n;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(t=e==null?void 0:e.draggable)!=null?t:r.draggable,droppable:(n=e==null?void 0:e.droppable)!=null?n:r.droppable}}E.Down,E.Right,E.Up,E.Left;export{Me as S,qe as _,U as a,V as r,ze as u};
